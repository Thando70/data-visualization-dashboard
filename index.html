<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q4 2024/2025 Crime Statistics Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        /* Custom styles for better readability and aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .chart-container {
            height: 400px;
            width: 100%;
        }
        /* Custom class for the status chips */
        .status-chip {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="mb-8 p-4 bg-white shadow-xl rounded-xl">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">
                South Africa Crime Statistics Dashboard
            </h1>
            <p class="text-lg text-indigo-600 font-semibold">
                Fourth Quarter (Q4) of 2024/2025 Financial Year (Jan - Mar 2025)
            </p>
            <p class="text-sm text-gray-500 mt-2">
                Data extracted from the official SAPS Crime Statistics Report.
            </p>
        </header>

        <!-- Key Metrics Cards -->
        <div id="metric-cards" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <!-- Cards will be populated here by JavaScript -->
        </div>

        <!-- Chart Area -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Chart 1: Reported Incidents -->
            <div class="bg-white shadow-xl rounded-xl p-4">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Total Reported Incidents</h2>
                <div id="incidents_chart" class="chart-container"></div>
            </div>

            <!-- Chart 2: Year-on-Year Change -->
            <div class="bg-white shadow-xl rounded-xl p-4">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Year-on-Year Change (%)</h2>
                <div id="change_chart" class="chart-container"></div>
            </div>
        </div>

        <!-- Data Source Table (Optional but good for transparency) -->
        <div class="mt-10 bg-white shadow-xl rounded-xl p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Underlying Data</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200" id="data-table">
                    <!-- Table content will be generated by JS -->
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data derived from the Q4 2024/2025 SAPS Crime Stats Report
        const crimeData = [
            { category: "Murder", incidents: 5727, change: -12.4, color: "#ef4444" },
            { category: "Aggravated Robbery", incidents: 31749, change: -10.4, color: "#f97316" },
            { category: "Kidnapping", incidents: 4571, change: 6.8, color: "#f59e0b" },
            { category: "Sexual Offences", incidents: 13452, change: 0.0, color: "#10b981" },
            { category: "Attempted Murder", incidents: 6985, change: -5.8, color: "#3b82f6" },
            { category: "Assault GBH", incidents: 43776, change: -5.3, color: "#8b5cf6" },
        ];

        // Function to determine the status chip appearance
        function getStatusChip(change) {
            let colorClass, icon;
            let formattedChange = (change > 0 ? "+" : "") + change.toFixed(1) + "%";

            if (change > 0.01) {
                // Negative trend (Increase in crime)
                colorClass = "bg-red-100 text-red-700";
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform -rotate-45" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>';
            } else if (change < -0.01) {
                // Positive trend (Decrease in crime)
                colorClass = "bg-green-100 text-green-700";
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform rotate-180" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>';
            } else {
                // Neutral trend (No change)
                colorClass = "bg-yellow-100 text-yellow-700";
                icon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 000 2v10a1 1 0 100-2V5a1 1 0 000-2z" clip-rule="evenodd" /><path d="M10 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1z" /></svg>';
            }
            return `<div class="status-chip ${colorClass}">${icon} ${formattedChange}</div>`;
        }

        // Function to render the key metric cards
        function renderMetricCards() {
            const container = document.getElementById('metric-cards');
            let html = '';

            crimeData.forEach(item => {
                const total = crimeData.reduce((sum, d) => sum + d.incidents, 0);
                const percentageOfTotal = ((item.incidents / total) * 100).toFixed(1);

                html += `
                    <div class="bg-white p-6 shadow-lg hover:shadow-xl transition-shadow duration-300 rounded-xl border-t-4 border-${item.color.slice(1)}-500">
                        <p class="text-sm font-medium text-gray-500">${item.category}</p>
                        <p class="text-3xl font-extrabold text-gray-900 mt-1 mb-3">${item.incidents.toLocaleString()}</p>
                        <div class="flex justify-between items-center">
                            ${getStatusChip(item.change)}
                            <p class="text-sm text-gray-600">${percentageOfTotal}% of Total</p>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Function to render the underlying data table
        function renderDataTable() {
            const table = document.getElementById('data-table');
            let html = `
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Crime Category</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Reported Incidents (Total)</th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Y-o-Y Change (%)</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
            `;

            crimeData.forEach(item => {
                const changeColor = item.change > 0.01 ? 'text-red-600 font-semibold' : (item.change < -0.01 ? 'text-green-600 font-semibold' : 'text-yellow-600');
                html += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-right">${item.incidents.toLocaleString()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right ${changeColor}">
                            ${(item.change > 0 ? "+" : "") + item.change.toFixed(1) + "%"}
                        </td>
                    </tr>
                `;
            });

            html += `</tbody>`;
            table.innerHTML = html;
        }


        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(() => {
            drawIncidentsChart();
            drawChangeChart();
            renderMetricCards();
            renderDataTable();
        });

        function drawIncidentsChart() {
            // Create the data table for incidents
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Crime Category');
            dataTable.addColumn('number', 'Reported Incidents');
            dataTable.addColumn({role: 'style'});

            crimeData.forEach(item => {
                dataTable.addRow([
                    item.category,
                    item.incidents,
                    item.color
                ]);
            });

            const options = {
                title: 'Reported Incidents by Crime Category (Jan-Mar 2025)',
                titleTextStyle: { color: '#4b5563', fontSize: 16, bold: true },
                legend: { position: 'none' },
                hAxis: {
                    title: 'Crime Category',
                    textStyle: { color: '#6b7280' }
                },
                vAxis: {
                    title: 'Number of Incidents',
                    format: 'short',
                    minValue: 0,
                    textStyle: { color: '#6b7280' }
                },
                chartArea: { width: '85%', height: '75%' },
                tooltip: { isHtml: true },
                animation: { duration: 1000, startup: true, easing: 'out' },
                backgroundColor: 'transparent',
                series: { 0: { color: '#4f46e5' } } // Consistent bar color
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('incidents_chart'));
            chart.draw(dataTable, options);
        }

        function drawChangeChart() {
            // Create the data table for Y-o-Y Change
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Crime Category');
            dataTable.addColumn('number', 'Y-o-Y Change (%)');

            crimeData.forEach(item => {
                dataTable.addRow([
                    item.category,
                    item.change
                ]);
            });

            const options = {
                title: 'Year-on-Year Percentage Change (Q4 2024/2025 vs Q4 2023/2024)',
                titleTextStyle: { color: '#4b5563', fontSize: 16, bold: true },
                legend: { position: 'none' },
                hAxis: {
                    title: 'Crime Category',
                    textStyle: { color: '#6b7280' }
                },
                vAxis: {
                    title: 'Change (%)',
                    format: '#.#%', // Show percentage with one decimal
                    textStyle: { color: '#6b7280' }
                },
                series: {
                    0: { // Line series
                        color: '#10b981',
                        lineWidth: 3,
                        pointSize: 8,
                        curveType: 'function'
                    }
                },
                // Add a baseline at 0 to clearly show increases vs decreases
                vAxis: {
                    baseline: 0,
                    baselineColor: '#e5e7eb',
                    gridlines: { color: '#f3f4f6' }
                },
                chartArea: { width: '85%', height: '75%' },
                animation: { duration: 1200, startup: true, easing: 'inAndOut' },
                backgroundColor: 'transparent'
            };

            const chart = new google.visualization.LineChart(document.getElementById('change_chart'));
            chart.draw(dataTable, options);
        }

        // Make charts responsive
        window.addEventListener('resize', () => {
            google.charts.setOnLoadCallback(() => {
                drawIncidentsChart();
                drawChangeChart();
            });
        });

    </script>

</body>
</html>
